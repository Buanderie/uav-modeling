\chapter{Sensory Equipment Equations} \label{chap:Sensors}

In this chapter, the equations that describe the measurements of the various quantities and states via hardware sensors are laid out. Sensors often times use complicated physical phenomena to obtain a measurement of the desired quantity and sometimes the conversion process isn't straightforward. An effort to document relevant information is done here. No effort to model measurement errors is done here.
Most of the following device descriptions correspond to their MEMS versions.

\section{Inertial Measurements}
The first and perhaps most used family of sensors in robotics are the inertial sensors. Fusing them allows the extraction of instantaneous orientation and acceleration data which in turn enables dead-reckoning. This is a sensor suite with large cumulative error, but with very high bandwidth, suitable for attitude control. In this chapter, we assume that the sensor axes are aligned with the body axes perfectly. A good source of relevant information is \cite[p.25]{Stevens2003}.

\subsection{Accelerometer}
An accelerometer installed onboard the aircraft measures the body-frame accelerations \textbf{except} the acceleration of gravity. As a result, when the aircraft is laid to rest on the ground the sensor records acceleration with magnitude of 1G, even though the aircraft isn't moving at all. This is similar to the apparent feeling a human has, feeling the force of his weight pulling him down when resting but feeling weightless while in free-fall.

In the ideal case where the accelerometer is installed at the center of gravity of the aircraft, the recorded acceleration is

\begin{IEEEeqnarray}{rCl} \label{eq:bootstrap}
	\bm{a}_{b,m} &= &\bm{a}_b - \bm{R}_b\bm{g}\\
	 &=  & \frac{\bm{F}_b}{m} - \bm{R}_b \bm{g} \IEEEyessubnumber
\end{IEEEeqnarray}

However, this is an ideal case. Most of the times, the sensor is placed in a point with coordinates $\bm{r}_{acc}$ relative to the center of gravity. The resulting measurement, affected by the aircraft rotational velocity will be

\begin{equation}
	\bm{a}_{b,m} =  \frac{\bm{F_b}}{m} -  \bm{R}_b\bm{g} + \dot{\bm{\omega}}_b \times \bm{r}_{acc} + \bm{\omega}_b \times (\bm{\omega}_b \times \bm{r}_{acc}) \IEEEyessubnumber \\
\end{equation}
which can be expanded into
\begin{IEEEeqnarray}{rCl}
	a_{m,x} &= & \frac{F_x}{m}+g\sin\theta -\dot{r}r_{acc,y}+\dot{q}r_{acc,z}+(-r^2-q^2)r_{acc,x}+pqr_{acc,y}+prr_{acc,z} \IEEEyessubnumber\\
	a_{m,y} &= & \frac{F_y}{m}-\sin\phi\cos\theta +\dot{r}r_{acc,x}-\dot{p}r_{acc,z}+pqr_{acc,x} + (-p^2-r^2)r_{acc,y} +qrr_{acc,z}\IEEEyessubnumber\\
	a_{m,z} &= & \frac{F_z}{m}-\cos\phi\cos\theta -\dot{q}r_{acc,x}+\dot{p}r_{acc,y}+prr_{acc,x}  +qrr_{acc,y} + (-p^2-q^2)r_{acc,z}\IEEEyessubnumber
\end{IEEEeqnarray}
The angular velocity derivatives can be further substituted using eq~\ref{eq:angVelDer}.
\subsection{Gyroscope}
Gyroscopes are sensors capable of measuring the rotational velocities of the rigid body they are attached onto. This measurement is unaffected by the location of placement.
\begin{equation}
	\bm{\omega_m} = \bm{\omega_b}
\end{equation}

\subsection{Magnetometer}
Magnetometers are sensors which measure the magnetic field of the Earth. At any given point on the surface of the Earth the vector field components are known and thus this sensor can be used to extract orientation information. The intensity of the magnetic field (measured usually in nanoTesla) is mostly constant, at about 45~000~nT. However, the direction of the magnetic flux lines changes radically from location to location \cite{wiki:declination}, \cite{wiki:inclination}, \cite{NOAAGeom}. If we express the magnetic field intensity as a vector quantity with North, East and Down components, for a given pair of coordinates
\begin{equation}
\bm{h} = [h_N, h_E, h_D]^T
\end{equation}

then we define as declination the angle
\begin{equation}
	dec = \tan^{-1}\left(\frac{h_E}{h_N}\right)
\end{equation}
and the inclination as
\begin{equation}
	inc = \tan^{-1}\left(\frac{h_D}{\sqrt{h_N^2 + h_E^2}}\right)
\end{equation}

The measurement of the onboard magnetometer will then be
\begin{equation} \label{eq:magField}
	\bm{h}_m = \bm{h}_b =\bm{R}_b \bm{R}_{inc}\bm{R}_{dec} \begin{bmatrix}
			\lvert \bm{h} \rvert \\ 0 \\ 0
	\end{bmatrix}
\end{equation}

\subsection{AHRS}
There also are hardware solutions which incorporate all three aforementioned sensors and extract an estimation of the Euler angles set.
\begin{equation}
	\bm{\Phi_{m}} = \bm{\Phi}
\end{equation}

\section{GPS Measurements}
In order to have a reading of the absolute position of the aircraft in the inertial frame, be it the local NED frame or the global frame, defined by latitude and longitude, a GPS sensor is required. This is the only reasonable option, as radio-location is not a viable option for low-cost and low-weight robotic platforms. Whether the system will use a simple GPS receiver, a multi-constellation receiver, differential measurements or even RTK packages improves only the measurement accuracy.

Common quantities reported by a GPS receiver are the longitude, latitude and altitude set. However, these do not correspond to the NED frame. In order to translate them to the north, east and down quantities we need to obtain the data on the curvature of the Earth at the location of interest. The following discussion should be adequate for the needs of a NED frame spanning a few kilometers to each direction of the starting coordinates.

Having done the above necessary conversions, we can treat the GPS receiver as a sensor which reports displacement in the local NED frame
\begin{equation}
\bm{p_{gps}} = \bm{p}
\end{equation}

Additionally, most GPS receivers report ground velocities
\begin{equation}
v_{gps} = \lVert [\dot{n}\ \dot{e}]' \rVert
\end{equation}
and the direction of travel, also referred to as the \emph{course angle}
\begin{equation}
\chi_{gps} = \operatorname{atan2}\left({\dot{e}},{\dot{n}}\right)
\end{equation}

\section{Atmospheric Measurements}

\subsection{Pressure}
Having defined the atmospheric model, we can now introduce a barometer sensor, which measures the barometric pressure at the UAV altitude.
\begin{equation}
	P_{bar} = P
\end{equation}

\subsection{Temperature}
Also, thermometers are available, which record the atmospheric temperature and are necessary for the extraction of altitude, through pressure readings. Care is needed however, as electronics are known to warm-up and raise the temperature in the enclosed spaces they are placed. However, this discussion belongs to an fault analysis and will not be expanded upon here.
\begin{equation}
	T_m =  T 
\end{equation}
What will be noted here is the fact that thermometers can be used to measure the temperature of components as well, such as batteries, ESCs or motors and provide a health status of those components.

\section{Air Data}
For an efficient and safe aircraft flight, air data measurements are required. These measurements refer to airspeed $\lVert V_a \lVert$, angle of attack $\alpha$ and angle of sideslip $\beta$.

Airspeed is measured using Pitot tubes, which take into account Bernoulli's equation to convert dynamic air pressure into airspeed readings. Essentially, a barometer is used to perform this reading.
\begin{IEEEeqnarray}{rCl}
	P_{t} &= & P + \frac{\rho V_a^2}{2} \IEEEyesnumber \IEEEyessubnumber \\
	P_{t,m} &= & P_t  \IEEEyessubnumber \\	
\end{IEEEeqnarray}

Aerodynamic angles $\alpha$ and $\beta$ can be measured using appropriate instruments, such as wind vanes, but such sensors are seldom found in medium and small UAVs, due to their size and weight.

\begin{equation}
	\alpha_m = \alpha
\end{equation}
\begin{equation}
	\beta_m = \beta
\end{equation}

\section{Distance Measurement}
Instruments which measure the distance of the UAV from the ground belong to this category. Common types are ultrasonic sensors, laser range finders and LIDARs. Their range varies from a few meters to a few hundred meters and their price range varies accordingly. What all these sensors have in common is that their measurements have a fixed range, varying from $d_{rf,min}$, the minimum reading, up to $d_{rf,max}$, in terms of absolute magnitudes.
\begin{equation}
	d_{rf} = \left\{ \begin{array}{ll}
	d_{rf, min} &,d>d_{rf,min} \\
	d &,h \in [d_{rf,min}, d_{rf,max}] \\
	d_{rm,max} &,d<d_{rf,max}
	\end{array}
	\right.
\end{equation}
Some confusion may be caused by the direction of the comparison ranges, but keep in mind that using the NED frame, $d$ is negative when the airplane is above ground altitude.

\section{Voltage Measurement}
Voltage Measurement is a very useful means to assess the remaining energy capacity of an onboard battery. Even though the relation between remaining energy and output voltage is not linear, useful conclusions can be extracted.

In general, any voltage level can be measured by such an instrument
\begin{equation}
	V_{i,m} = V_i
\end{equation}

but in the specific case of the battery voltage measurement we have
\begin{equation}
	V_{B,m} = V_B - I_o R_B
\end{equation}

\section{Current Measurement}
Similarly to voltage measurements, current measurements are available as well. These are useful to monitor the power consumption of the aircraft and, in extension, are a valid means to approach the thrust produced by the power plant.

Usually, current sensors are placed on the battery leads, since their most common occurrence measures only DC current.
\begin{equation}
	I_{o,m} = I_o
\end{equation}

\section{Motor Angular Velocity Measurement}
Finally, a quantity with great informational content is the rotational velocity of the motor shaft. This can be measured with commercial RPM sensors and can provide information on the thrust produced or even the health status of the motor itself.
\begin{equation}
	n_{m} = n
\end{equation}